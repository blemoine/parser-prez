<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>reveal.js</title>

    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/reveal.css" />
    <link rel="stylesheet" href="css/theme/black.css" />

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/monokai.css" />

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement('link');
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <style>
      .svg-tree {
        padding: 10px;
        border: 1px solid white;
      }
      .svg-tree .svg-text {
        fill: white;
        font-size: 32px;
      }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section>
          <h1>Comment choisir et utiliser un parser pour son DSL&nbsp;?</h1>
        </section>

        <section>
          <h2>Qui suis-je&nbsp;?</h2>
          <ul style="display:inline-block;width:600px;vertical-align:top;position:relative;">
            <li>Benoît Lemoine</li>
            <li>
              Développeur Fullstack <br />(TypeScript / Scala) <br />chez <a href="http://www.mnubo.com">mnubo</a> à
              Montréal
            </li>
            <li><a href="https://twitter.com/benoit_lemoine">@benoit_lemoine</a></li>
          </ul>
          <img
            style="display:inline-block;width:250px; vertical-align:top;"
            src="img/Moloch.png"
            alt="Plus bel animal du monde, le Moloch"
          />
        </section>

        <section>
          <h2>Qu'est qu'un DSL&nbsp;?</h2>
          <ul>
            <li><strong>D</strong>omain <strong>S</strong>pecific <strong>L</strong>anguage</li>
            <li class="fragment">Language spécialisé pour un domaine applicatif</li>
            <li class="fragment">Respecte une grammaire - régles permettant de valider si un énoncé est correct</li>
            <li class="fragment">Par ex: SQL, markdown</li>
          </ul>
        </section>

        <section>
          <h2>Qu'est qu'un parser&nbsp;?</h2>
          <code class="fragment">String -> Concrete Syntax Tree </code>
          <p class="fragment">Parser vérifie uniquement la syntaxe et pas la sémantique</p>
        </section>

        <section>
          <h2>Example</h2>
          <div>
            <code>1 + 2 * 3</code>
          </div>
          <div style="display: flex; align-items: top;justify-content: space-around">
            <div class="fragment">
              <div>CST</div>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="290px"
                height="300px"
                viewBox="0 0 290 300"
                class="svg-tree"
              >
                <text class="svg-text" x="50" y="24">Operator</text>
                <text class="svg-text" x="100" y="72">+</text>
                <text class="svg-text" x="0" y="144">Number</text>
                <text class="svg-text" x="42" y="192">1</text>
                <text class="svg-text" x="140" y="144">Operator</text>
                <text class="svg-text" x="190" y="192">*</text>
                <text class="svg-text" x="50" y="248">Number</text>
                <text class="svg-text" x="100" y="292">2</text>
                <text class="svg-text" x="170" y="248">Number</text>
                <text class="svg-text" x="220" y="292">3</text>

                <line x1="108" y1="72" x2="58" y2="118" stroke="white" stroke-width="3"></line>
                <line x1="108" y1="72" x2="189" y2="118" stroke="white" stroke-width="3"></line>

                <line x1="195" y1="185" x2="108" y2="222" stroke="white" stroke-width="3"></line>
                <line x1="195" y1="185" x2="220" y2="222" stroke="white" stroke-width="3"></line>

                <line x1="107" y1="30" x2="107" y2="48" stroke="white" stroke-width="3"></line>
                <line x1="50" y1="148" x2="50" y2="167" stroke="white" stroke-width="3"></line>

                <line x1="196" y1="148" x2="196" y2="165" stroke="white" stroke-width="3"></line>
                <line x1="107" y1="250" x2="107" y2="268" stroke="white" stroke-width="3"></line>
                <line x1="227" y1="250" x2="227" y2="268" stroke="white" stroke-width="3"></line>
              </svg>
            </div>
            <div class="fragment">
              <div>AST</div>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="290px"
                height="300px"
                viewBox="0 0 290 300"
                class="svg-tree"
              >
                <text class="svg-text" x="100" y="72">+</text>
                <text class="svg-text" x="50" y="144">1</text>
                <text class="svg-text" x="190" y="192">*</text>
                <text class="svg-text" x="100" y="248">2</text>
                <text class="svg-text" x="220" y="248">3</text>

                <line x1="108" y1="72" x2="58" y2="118" stroke="white" stroke-width="3"></line>
                <line x1="108" y1="72" x2="189" y2="168" stroke="white" stroke-width="3"></line>

                <line x1="195" y1="185" x2="108" y2="222" stroke="white" stroke-width="3"></line>
                <line x1="195" y1="185" x2="220" y2="222" stroke="white" stroke-width="3"></line>
              </svg>
            </div>
            <div class="fragment">
              <div>AST - Json</div>
              <code style="font-size: 63%">['+', 1, ['*', 2, 3]]</code>
            </div>
          </div>
        </section>

        <section>
          <h2>Pourquoi&nbsp;?</h2>
          <ul>
            <li class="fragment">Faire des formules <em>à la excel</em></li>
            <li class="fragment">
              Supporter un sous/sur ensemble d'un langage existant (e.g. JSON avec commentaires)
            </li>
            <li class="fragment">Interface Utilisateur permettant de saisir des commandes (e.g. chat)</li>
            <li class="fragment">Valider (et simplifier) un fichier de configuration</li>
            <li class="fragment">Créer son propre langage de programmation</li>
            <li class="fragment">etc.</li>
          </ul>
        </section>

        <section>
          <h2>Les solutions... <span class="fragment">discutables</span></h2>

          <ul>
            <li class="fragment"><code>eval</code> et langages <em>DSLables</em> (ex. scala ou groovy)</li>
            <li class="fragment">Lié fortement à une plateforme</li>
            <li class="fragment">Difficulté à valider les entrées <code>=></code> problémes de sécurité</li>
            <li class="fragment">Limitation des grammaires possibles</li>
          </ul>
        </section>

        <section>
          <h2>Machine Learning et NLP</h2>
          <ul>
            <li class="fragment"><code>1 + 2</code> ?</li>
            <li class="fragment"><code>2.987432</code> avec une probabilité de 98%</li>
            <li class="fragment">
              L'imprécision sur la grammaire d'entrée entraîne une imprécision sur le résultat de sortie
            </li>
          </ul>
        </section>

        <section>
          <h2>hiérarchie de langage de Chomsky</h2>
          <p>
            Langage : ensemble de <em>mots</em> construits à partir d'un alphabet et respectant des régles de grammaire
          </p>
          <img src="img/Hierarchie_chomsky.png" alt="hierarchie chomsky" style="height: 300px; background: white" />
        </section>

        <section>
          <h2>Parser un langage régulier</h2>
          <p class="fragment">Utiliser les expressions régulières - aka Regex</p>
          <ul>
            <li class="fragment">Code Postaux au Canada</li>
            <li class="fragment"><code>K1A 0B1</code> ou <code>H0H 0H0</code></li>
            <li class="fragment"><code>[A-CEGHJ-NP-TVXY][0-9][A-CEGHJ-NP-TVXY] [0-9][A-CEGHJ-NP-TVXY][0-9]</code></li>
          </ul>
        </section>

        <section>
          <h2>PAS DE REGEX POUR LES LANGAGES NON CONTEXTUEL</h2>

          <a
            class="fragment"
            style="font-size: 31px"
            href="https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags"
          >
            a mere glimpse of the world of reg​ex parsers for HTML will ins​tantly transport a programmer's
            consciousness into a world of ceaseless screaming,... HTML tags lea͠ki̧n͘g fr̶ǫm ̡yo​͟ur eye͢s̸ ̛l̕ik͏e liq​uid pain,
            the song of re̸gular exp​ression parsing will exti​nguish the voices of mor​tal man from the sp​here I can
            see it can you see ̲͚̖͔̙î̩́t̲͎̩̱͔́̋̀ it is beautiful t​he final snuffing of the lie​s of Man ALL IS LOŚ͖̩͇̗̪̏̈́T ALL I​S LOST the
            pon̷y he comes he c̶̮omes he comes the ich​or permeates all MY FACE MY FACE ᵒh god no NO NOO̼O​O NΘ stop the
            an​*̶͑̾̾​̅ͫ͏̙̤g͇̫͛͆̾ͫ̑͆l͖͉̗̩̳̟̍ͫͥͨe̠̅s ͎a̧͈͖r̽̾̈́͒͑e n​ot rè̑ͧ̌aͨl̘̝̙̃ͤ͂̾̆ ZA̡͊͠͝LGΌ ISͮ̂҉̯͈͕̹̘̱ TO͇̹̺ͅƝ̴ȳ̳ TH̘Ë͖́̉ ͠P̯͍̭O̚​N̐Y̡ H̸̡̪̯ͨ͊̽̅̾̎Ȩ̬̩̾͛ͪ̈́̀́͘ ̶̧̨̱̹̭̯ͧ̾ͬC̷̙̲̝͖ͭ̏ͥͮ͟Oͮ͏̮̪̝͍M̲̖͊̒ͪͩͬ̚̚͜Ȇ̴̟̟͙̞ͩ͌͝S̨̥̫͎̭ͯ̿̔̀ͅ
          </a>
        </section>

        <section>
          <h2>Parser un langage non contextuel</h2>

          <ul>
            <li>Parsing manuel</li>
            <li>Parser combinator</li>
            <li>Parser generator</li>
            <li>Parser exotiques...</li>
          </ul>
        </section>

        <section>
          <h2>Les points d'attention</h2>
          <ul>
            <li class="fragment">Performance</li>
            <li class="fragment">La gestion des erreurs</li>
            <li class="fragment">Transformation du CST en AST</li>
            <li class="fragment">Facilité d'utilisation</li>
            <li class="fragment">Maintenabilité</li>
          </ul>
        </section>

        <section>
          <h2>Example - Subset of JSON</h2>
          <pre><code data-trim>
            ["Peter", 12, [null, 14]]
          </code></pre>
        </section>

        <section>
          <h2>Parser manuel</h2>
          <ul style="list-style: none">
            <li class="fragment">
              <code>+</code> Meilleurs performances <span class="fragment">(si on fait l'effort)</span>
            </li>
            <li class="fragment"><code>-</code> Non portable</li>
            <li class="fragment">
              <code>-</code> Le moins maintenable <span class="fragment">(même si on fait l'effort)</span>
            </li>
          </ul>
        </section>

        <section>
          <h2>Parser combinator</h2>
          <ul>
            <li>Combinator = function prenant plusieurs parsers en entrée et renvoyant un parser en sortie</li>
            <li>On construit donc le parser du langage en <em>combinant</em> des parsers plus simples</li>
          </ul>
        </section>

        <section>
          <h2>Parsimmon</h2>
          <pre><code data-trim class="javascript">
const __ = P.optWhitespace;
const Null = P.string('null').result(null);
const String = P.regexp(/"([^\0-\x1F\x22\x5C]*)"/, 1);
const Number = P.regexp(/-?[1-9]*[0-9]+(\.[0-9]+)?/)
                .map((str) => parseFloat(str));
const Array = P.sepBy(P.lazy(() => Json),
                      P.string(',').trim(__))
               .wrap(P.string('[').skip(__),
                     __.then(P.string(']')));
const Json = P.alt(Null, Number, String, Array).wrap(__, __);
          </code></pre>
        </section>

        <section>
          <h2>Parser combinator</h2>
          <ul style="list-style: none">
            <li class="fragment">
              <code>+</code> Bonne maintenabilité<span class="fragment"
                >, en particulier si on connait la programmation fonctionnelle</span
              >
            </li>
            <li class="fragment"><code>+</code> Pas d'étape de build intermédiaire</li>
            <li class="fragment"><code>+</code> "Facile" à debugger</li>
            <li class="fragment"><code>-</code> Mauvaises performances</li>
            <li class="fragment"><code>-</code> Non portable</li>
          </ul>
        </section>

        <section>
          <h2>Parser generator</h2>
          <ul>
            <li class="fragment">Grammaire dans un DSL</li>
            <li class="fragment">Génère un parser à partir de la grammaire</li>
            <li class="fragment">Peut nécessiter ou non un runtime</li>
          </ul>
        </section>

        <section>
          <h2>Étape intermediaire du lexer</h2>
          <ul>
            <li class="fragment">String -> List[Token] -> CST</li>
            <li class="fragment">
              <code>
                '["name", 12]' -> [LEFT_SQUARE_BRACKET, STRING("name"), COMMA, NUMBER(12), RIGHT_SQUARE_BRACKET]
              </code>
            </li>
          </ul>
        </section>

        <section>
          <h2>Backus Naur Form aka BNF</h2>
          <p class="fragment">EBNF, ABNF (RFC 5234), etc.</p>

          <pre class="fragment"><code data-trim>
             begin-array     = ws %x5B ws  ; [ left square bracket
             end-array       = ws %x5D ws  ; ] right square bracket
             value-separator = ws %x2C ws  ; , comma
             quotation-mark = %x22      ; "
             ws = *(%x20) ; space
             null  = %x6e.75.6c.6c      ; null
             value = null / array / string
             string = quotation-mark *char quotation-mark
             array = begin-array [
                         value *( value-separator value )
                     ] end-array
          </code></pre>
        </section>

        <section>
          <h2>Left recursion</h2>
          <pre><code data-trim>1 + 20 + 34</code></pre>
          <pre><code data-trim>
          expression = expression + number \ number
          number = 1*DIGIT
          </code></pre>
        </section>

        <section>
          <h2>Ambiguïtés</h2>
          <pre><code data-trim>
          stmt = "true" \ "false" \ if-expression
          if-expression = "if" stmt "then" stmt \
                          "if" stmt "then" stmt "else" stmt
          </code></pre>
          <pre><code data-trim>
            if true then if false then true else false
          </code></pre>
        </section>

        <section>
          <h2>Error handling</h2>

          - dans le parser S'arrete a la premiere erreur ou pas ? - dans le generator?
        </section>

        <section>
          <h2>CST -> AST</h2>
          <ul>
            <li class="fragment">Visitor - langage agnostique</li>
            <li class="fragment">Actions intégrées - plus proche de la grammaire</li>
          </ul>
        </section>

        <section style="position:relative">
          <h2>Famille de grammaire/algo</h2>
          <ul>
            <li>LL(1), LL(k), LL(*)</li>
            <li>LR(1), LR(k) SLR(1), LALR(1)</li>
            <li>Peg</li>
            <li>Earley</li>
          </ul>
          <div
            class="fragment"
            style="position:absolute; top:100px; color: #C00; font-size: 8rem;transform: rotate(-45deg); left: 0;"
          >
            On s'en moque
          </div>
        </section>

        <section>
          <h2>Example: Nearley</h2>
          <p>Earley pour JavaScript, actions intégrées.</p>
        </section>

        <section>
          <h2>Example: ANTLR</h2>
          <p>LL(*), visitor</p>
        </section>

        <section>
          <h2>Quelques features a regarder</h2>
          <ul>
            <li class="fragment">
              Représentation sous forme de rails
              <img alt="rail diagram" src="img/object.png" style="background: white" />
            </li>
            <li class="fragment">Outillage de debug/test</li>
            <li class="fragment">Génération de chaine valide</li>
          </ul>
        </section>

        <section>
          <h2>Conclusion - avez vous besoin d'un parser</h2>

          <ul>
            <li>Si vous avez déjà un parser composé de pleins de regex</li>
            <li>Si vous vous appretez a présenter un format texte au end user (par ex liste de course)</li>
          </ul>
        </section>
        <section>
          <h2>Conclusion - quel parser choisir</h2>

          <ul>
            <li>Tester les !</li>
            <li class="fragment">Si simple et performance ne compte pas, parser combinator</li>
            <li class="fragment">Si moins simple ou que les perfs sont importantes, parser generator</li>
            <li class="fragment">Se focaliser sur la maintenabilité</li>
          </ul>
        </section>
        <section>
          <h2>Famille de grammaire</h2>
          <h3>Si vous voulez <em>vraiment</em> savoir</h3>
          <ul>
            <li>LR et Earley et PEG supporte la récursion a gauche<sup>*</sup></li>
            <li>LR et Earley sans ambiguités</li>
            <li>Earley > LR > LL en terme de langages pouvant être parsé</li>
          </ul>
        </section>
      </div>
    </div>

    <script src="js/reveal.js"></script>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        hash: true,
        history: true,
        dependencies: [
          { src: 'plugin/markdown/marked.js' },
          { src: 'plugin/markdown/markdown.js' },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/highlight/highlight.js', async: true },
        ],
      });
    </script>
  </body>
</html>
